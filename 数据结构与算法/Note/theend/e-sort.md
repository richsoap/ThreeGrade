# 文件系统
## 文件分类
* 操作系统的文件，连续的字符序列，具有明显的结构。
* 数据库文件，有结构的记录集合，每条记录有一个或多个数据项，每个数据项都是原子的
* 定长文件
每条记录军含有相同的信息长度，那么这种文件称为定长文件
* 不定长文件，记录不是相等长度的
* 单关键码文件
* 多关键码文件
* 实时操作
* 批量文件处理
## 文件组织
### 逻辑组织
* 顺序结构的定长记录
* 顺序结构的变长记录
* 按关键码存取的记录
### 物理结构
* 顺序文件
* 散列文件
* 索引文件
* 倒排文件
### 流文件
流文件不是文件，是流
# 外排序
## 定义
数据存放在外存文件中，则需要考虑外存特点，采用外存文件排序技术
## 术语
* 顺串/归并段：已排序的段或有序的子文件
## 流程
* 文件要形成尽可能长的初始顺串
* 逐趟归并顺串
## 时间消耗
* 内排序
* 读写
* 归并(最耗时)
## 归并趟数
假设有m个初始顺串，每次归并k个，则归并趟数为[log_km]
## 置换选择排序
### 流程
读一段文件到输入缓冲区，向RAM放入序列并进行排序，然后写到输出缓冲区，输出缓冲器满后，再写回外存，输入缓冲区空，则又从外存读入
### 顺串的产生
* 读入M个记录到RAM
* 设置队尾指标M-1
* 在RAM里维护一个最小堆
* 每次将具有最小关键码值的记录送到缓冲区
* 判断输入缓冲区中的下一条记录是否大于刚刚输出的关键码
* 是：把R放到根结点
* 否：用队尾记录代替根节点，并将该记录放到队尾，队尾指标减一(读入该记录，提高内存利用率，但不要将该值读入排序)
* 平均情况下可以形成长度为2M的顺串
## 二路外排序
### 流程
将数据文件划分成若干段，用有效的内排序方法对文件的各段进行初始排序以形成顺串，再逐趟合并
### 特点
* 为一个待排文件创建尽可能大的初始顺串，大大减少扫描次数和外存读写次数
* 归并顺序安排也影响读写次数(哈夫曼树最优化问题)
## 选择树(归并算法)
文件读完后，插入Infty
### k路归并
m个初始顺串，需要归并趟数为需要归并趟数为logk_m
#### 赢者树
结点记录的是胜者
#### 败者树
结点记录的是败者。每次重构，都只需要和父节点比较即可，无需找到兄弟节点，最后的胜者单独拿出来作为输出
### 效率
对k个顺串进行归并
* 原始方法：找到最小值用时O(k)，产生一个大小为n的顺串用时O(nk)
* 败者树，对k个顺串进行归并，初始化k个选手的败者树，用时O(k),输入新值重构用时O(logk)，产生长度为n的顺串用时O(k+nlogk)=O(nlogk)
