# 目录
## 基本概念
* 输入顺序文件：按照记录进入系统的顺序存储记录，相当于一个磁盘中未排序的线性表，不支持高效率检索
* 主码：库中每条记录的唯一标识
* 辅码：库中可以出现重复值的码，大多数检索都是基于辅码的
* 索引：把一个关键码与它对应的数据记录的位置相关联的过程
* 索引文件：每个索引文件支持一个关键码字段，从而不需要重排主文件即可访问相应关键码(空间换时间)
* 稠密索引：对每个记录建立一个索引项，主文件不按照关键码的顺序排列
* 稀疏索引：对一组记录建立一个索引，按照关键码的顺序存放，并将记录分块
## 线性索引
### 基本概念
* 按照关键码的顺序进行排序
* 文件指针指向存储在磁盘上的文件记录起始位置或主索引中主码的起始位置
### 优点
* 对变长数据库的访问
* 对数据进行高效检索(二分)
* 顺序处理方便
* 无需其他储存结构
### 问题
* 一级线性索引实在是大
* 更新太过麻烦
### 二级线性索引
* 用一个线性索引指向存满一级索引的磁盘块
* 一般会将二级索引指向一级索引块的起始位置
## 静态索引
* 静态：文件创建，装入记录时就已产生，除非文件再组织，否则索引文件不变
* 普遍使用多叉树减少访问外存次数
## 倒排索引
* 基于属性的检索：要求索引结构中某个或若干个属性满足一定条件的结点，不是按照关键码的值检索
* 倒排表：对某属性按属性值建立索引表，和主文件顺序不同，所以被称为倒排索引
* 一般情况下是离散的，若连续则用B树
* 倒排文件：带有倒排索引的文件
### 优点
* 能够对于基于属性的检索进行较高效率的处理
### 缺点
* 花费了更多空间，且更新复杂
### 词索引
* 把正文看作由符号和词组成的集合，并从正文中抽取出来，如何用这些关键词组成适用于快速检索的数据结构
* 适用于多种文本类型，特别是容易解析的文本(英文...)，但对于需要切词的中文等东方文字不友好
### 全文索引
* 正文是一个长的字符串，在数据中记录字子串开始的位置
* 可以对每一个字符都建立索引，所以查找比较方便
* 需要更多的空间
### 实现
* 由于倒排的离散性，所以用词索引的较多
#### 建立
1. 对文档集中的所有文件都进行分割处理，将正文分成多条记录文档
* 看具体要求决定如何切分
2. 给每条记录赋一组关键词
* 以人工或自动的方式从记录中抽取关键词
3. 建立正文倒排表，倒排文件
* 得到各个关键词的集合，对于每个关键词得到其倒排表，任何将倒排表存入文件
#### 检索
1. 在倒排文件中检索关键词
2. 根据倒排表得到相应的记录
* 一般会用字典或其他索引结构对关键词进行有效检索
### 优缺点
* 高效检索
* 检索词有限，倒排文件索引效率不高，空间代价太大
## 动态索引
* 索引结构本身也可能发生变化
* 在系统运行过程中插入或删除记录比较方便
* 从而获得较好的性能
### m阶B树
* 每个结点至多有m个子结点(有m-1个关键码-地址对)
* 除根结点和叶节点，其他结点至少有 $\left\lceil\frac{m}{2}\right\rceil-1$ 个子结点
* 根结点至少有两个子结点
* 所有的叶节点都在同一层
* 有k个子结点的非根结点恰好包含k-1个关键码
#### 特点
* 树高平衡，所有叶节点都在同一层
* 关键码没有重复
* 值接近的记录都在同一页(访问局部性原理)
* B树保证至少有一定比例的结点是满的，从而提高空间利用率
#### 检索长度
* 树高为h，则检索至多读盘数为h
#### 插入
插入需要保持等高和阶的限制，若溢出则中间关键码同新指针插入父节点，若父节点也溢出，则继续分裂，最后可到根结点，使树升高一层
#### 读写次数计算
* 每读一个节点就需要读一次(从根节点开始向下读)(插入还差一个数据就满的结构也需要写)，每写一个节点就需要写一次，此处已假设向下检索时读入的结点在插入后向上分裂时也无需再次读入
* 对于高度为h的树，最多读写:向下读盘次数[h]+分裂时非根结点写盘次数[2(h-1)]+分裂根结点时的写盘次数[3]=3h+1
#### 删除
* 若关键码不在叶节点，就将该码和B树中的后继对换位置，然后再删除该关键码
* 如果在叶节点：删除后数量足够，直接删除；否则从兄弟节点借关键码
#### 性能分析
* 包含N个关键码，有N+1个外部空指针，且都在k层
* 根：至少两节点
* 第k层至少 $2\left\lceil\frac{m}{2}\right\rceil^{k-1}$
* 求和得 $N+1\geq2\left\lceil\frac{m}{2}\right\rceil^{k-1},k\leq1+log_{\left\lceil\frac{m}{2}\right\rceil}(\frac{N+1}{2})$
* 则对于N=1999998，m=199时，k=4，一次最多检索4层
### B+树
* 每个节点至多m个子结点
* 每个节点至少有 $\left\lceil\frac{m}{2}\right\rceil$ 个子结点
* 根结点至少有两个子结点
* 有k个子结点的节点必有k个关键码
#### 查找
* 查找应当一层层地到达叶节点层
* 叶节点一般用双链表连接
#### 插入
* 过程与B树类似
* 注意保证上一层结点中有这两个结点的最大/最小关键码
